<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#2b2b2b;"><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.datasupplier.data.BankData<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.datasupplier.service.BankDataSupplierService<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.rtneo.entity.*<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">org.apache.commons.collections4.CollectionUtils<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">java.math.RoundingMode;<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">java.text.DecimalFormat;<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">java.text.DecimalFormatSymbols;<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.github.declinationofnames.*<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.haulmont.cuba.core.global.*;<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.rtneo.core.bean.calculation.CalculationWorkerHelper<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.rtneo.service.AccrualService<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.rtneo.data.ContainerYardSearchData<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.rtneo.core.bean.ContainerYardWorker<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">org.apache.commons.lang.StringUtils<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.groupstp.rtneo.service.CompanyService<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.haulmont.cuba.core.app.*;<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">com.haulmont.cuba.core.entity.EntitySnapshot;<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">java.text.DateFormat;<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">import </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">java.text.SimpleDateFormat;<br /><br />ViewRepository vRep = AppBeans.get(ViewRepository.NAME)<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//def contract = dataManager.reload(params['contract'],'contract-print')<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">r1 = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;d3f1c53b-6db5-4616-cefd-77549f4b6083&quot;<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">params = [:]<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">contract = dataManager.load(Contract.</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">class</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).id(UUID.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">fromString</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(r1)).view(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contract-print'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).optional().orElse(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br /><br />DateFormat df = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">SimpleDateFormat(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;dd.MM.yyyy&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />Calendar cal = Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">getInstance</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">();<br /><br />cal.setTime(contract.getFrom());<br />cal.set(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">DAY_OF_MONTH</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, cal.getActualMinimum(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">DAY_OF_MONTH</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">));<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">startFrom = df.format(cal.getTime())<br /><br />cal.setTime(contract.getBefore());<br />cal.set(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">DAY_OF_MONTH</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, cal.getActualMaximum(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">DAY_OF_MONTH</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">));<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">endBefore = df.format(cal.getTime())<br /><br />Contragent contragent = contract.getContragent()<br /><br />LinkedHashMap&lt;String, Object&gt; props = getRequisites(contract, params, df, startFrom, contragent)<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//позиции по договору<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">units = [];<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">realEstates = [];<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">calculations = [];<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//контейнерные площадки<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">containers = [];<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">containersUnique = [];<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">accrualsGroup = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">TreeMap&lt;&gt;();<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />//Объемы арендаторов за которые оплачивает арендодатель<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">rentersGroup = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">TreeMap&lt;&gt;();<br /><br />View creView = vRep.getView(ContragentRealEstate.</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">class</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;_local&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />creView.addProperty(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;contragent&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, vRep.getView(Contragent.</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">class</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;_local&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">));<br />creView.addProperty(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;ownType&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br /><br />//заполняем позиции<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">n = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">int </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">startCount = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">1<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContractPosition position: contract.getPositions()){<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />    //Оплата арендодателем<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isPayLandlord = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isOwner = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isCnC = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isFact = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//////////////////////<br />    <br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(isFact, isCnC, isPayLandlord, isOwner) = setPositionMark(position, creView, contragent)<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(CollectionUtils.isEmpty(position.getAccruals()) &amp;&amp; !isFact) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">continue<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br /><br />    realEstateNums = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">realEstatePos = [:]<br />    calculation = [:]<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//бегаем по начислениям<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal totalVolumePosition = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal tariff = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal amountBaseRent = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(Accrual accrual: position.getAccruals()){<br />        tariffNoNDS = round(getNN(accrual.getPrice())*</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">/</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">6</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />        totalVolumePosition+=getNN(accrual.getAmountBase())<br />        amountBaseRent += isCnC &amp;&amp; isPayLandlord?getNN(accrual.getAmountBase()):BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">createAccrualsGroup(accrualsGroup, accrual, isCnC, isPayLandlord)<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(isCnC &amp;&amp; isPayLandlord){<br />            fillRentersGroup(accrual, rentersGroup)<br />        }<br /><br />    }<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">realEstatesWasteProject = [];<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//бегаем по площадкам<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getContainerYards()!=</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//заполняем массив КП<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContractPositionContainerYard contractPositionContainerYard: position.getContainerYards()){<br />            containerYard = contractPositionContainerYard.getContainerYard()<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//            realEstatePos['containerYardNumber'] = containerYard.getCode();<br /><br />            //выдираем из проекта лимитов ОН<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getWasteProject()!=</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />                realEstateP = [:]<br />                realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'realEstateName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = contractPositionContainerYard.getContragentRealEstate().getRealEstate().getName()<br />                realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'cadastralNumber'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = contractPositionContainerYard.getContragentRealEstate().getRealEstate().getCadastralNumber()<br />                realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'address'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = contractPositionContainerYard.getContragentRealEstate().getRealEstate().getAddress()<br />                realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'containerYardNumber'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = containerYard.getCode();<br />                realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'n'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = ++n<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(realEstateNums.length()&gt;</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />                    realEstateNums+=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">','<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br /><br />                realEstateNums+=realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'n'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />                realEstatesWasteProject.add(contractPositionContainerYard.getContragentRealEstate().getId())<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!isCnC) realEstates.push(realEstateP)<br />            }<br /><br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(containersUnique.indexOf(containerYard.getId())&lt;</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />                containersUnique.push(containerYard.getId())<br />                getContainers(containerYard, isFact, containers, startFrom, endBefore)<br />            }<br />        }<br />    }<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//добираем объекты недвижимости из ПЛООНР, для которых не найдены КП<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getWasteProject() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContragentRealEstate cre: position.getWasteProject().getRealEstates()){<br />            cre = dataManager.reload(cre, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;contragentRealEstate-categorization&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br /><br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(realEstatesWasteProject.indexOf(cre.getId())&gt;=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">continue</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />            }<br /><br />            realEstateP = [:]<br />            realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'realEstateName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = cre.getRealEstate().getName()<br />            realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'cadastralNumber'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = cre.getRealEstate().getCadastralNumber()<br />            realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'address'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = cre.getRealEstate().getAddress()<br />            realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'n'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = ++n<br /><br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(realEstateNums.length()&gt;</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />                realEstateNums+=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">','<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br /><br />            realEstateNums+=realEstateP[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'n'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />            realEstates.push(realEstateP)<br />        }<br />    }<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!isCnC &amp;&amp; position.getWasteProject() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />        ++n<br />        List&lt;ContractPositionContainerYard&gt; cpcyHistory = getHistoryCY(contragent, position)<br />        List&lt;HashMap&lt;String, Object&gt;&gt; itemsCY = getHistoryPrintItemsCY(cpcyHistory, startCount++)<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">item : itemsCY){<br />            realEstates.push(item)<br />        }<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">////////////////////////////////////////////////////////////<br />        //Добавляем в список объектов через запятуюrealEstates<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(realEstateNums.length()&gt;</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />            realEstateNums+=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">','<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />        realEstateNums+=n<br />    }<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!isCnC){<br />        getCalculation(position, calculation, df, totalVolumePosition, accrualsGroup, contract, realEstateNums, isFact)<br />        calculations.push(calculation)<br />    }<br />}<br /><br />List renters = getRenters(rentersGroup)<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//рассчет итогов<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal amountBaseAll = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//for (ContractPosition position: contract.getPositions()){<br />//    amountBaseAll += position.getVolumeYear()<br />//}<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal amountBase = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal amountBaseNoRent = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal amountBaseRent = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal totalSumBaseNoNds = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal totalSumBase = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal discount = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal totalSum = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">accruals = []<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(item </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">in </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">accrualsGroup){<br />    amountBase+=item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBase'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    amountBaseNoRent+=item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseNoRent'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    amountBaseRent+=item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseRent'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    totalSumBaseNoNds = totalSumBaseNoNds + item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBaseNoNds'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">].setScale(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, RoundingMode.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">HALF_UP</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    totalSumBase = totalSumBase + item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBase'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">].setScale(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, RoundingMode.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">HALF_UP</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    discount = discount + item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'discount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">].setScale(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, RoundingMode.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">HALF_UP</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    totalSum = totalSum + item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSum'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">].setScale(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, RoundingMode.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">HALF_UP</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br /><br />    LinkedHashMap&lt;String, Object&gt; accrual = createAccrual(item)<br />    accruals.push(accrual)<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//массив итогов<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">totals = [<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />        //'amountBaseAll' : getNumber(amountBaseAll, false),<br />        //'amountBase' : getNumber(amountBase, false),<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBase' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getFormatNum(amountBase, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">),<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseNoRent' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getFormatNum(amountBaseNoRent, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">),<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseRent' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getFormatNum(amountBaseRent, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">),<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBaseNoNds' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(totalSumBaseNoNds),<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBase' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(totalSumBase),<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'discount' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(discount),<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSum' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(totalSum)<br />]<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">[[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'props'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:props,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'realEstates'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: realEstates, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculations'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: calculations, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totals'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:totals, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'containers'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: containers, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'accruals'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: accruals, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'renters'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: renters]]<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">List setPositionMark(ContractPosition position, View creView, Contragent contragent) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isPayLandlord = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isOwner = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isCnC = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isFact = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Проверяем на null<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getContragentRealEstate() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">&amp;&amp; !position.getContragentRealEstate().isDeleted()) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">rentCre = position.getContragentRealEstate();<br />        rentCre = dataManager.reload(rentCre, creView);<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Арендатор или собственник<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(rentCre.getOwnType().equals(TypeOwnership.RENT)) {<br />            isOwner = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">true</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        }<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Если за объект оплачивает арендодатель<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(isOwner &amp; isPayLandLord(position.getContragentRealEstate())) {<br />            isPayLandlord = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">true</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        }<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Если позиция создалась с объектом арендодателя<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(isOwner &amp;&amp; !contragent.getId().equals(rentCre.getContragent().getId())) {<br />            isCnC = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">true</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        }<br />    }<br /><br />    isFact = dataManager.loadValue(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'select cp.isFactCalculation from rtneo$ContractPosition cp where cp.id = :id'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, Boolean.</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">class</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).parameter(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;id&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, position.getId()).optional().orElse(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />    [isFact, isCnC, isPayLandlord, isOwner]<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">LinkedHashMap&lt;String, Object&gt; createAccrual(Map.Entry&lt;Object, Object&gt; item) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">[<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'period'           </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'period'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">],<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'tariff'           </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'tariff'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />            //'amountBase': getNumber(item.getValue()['amountBase'], false),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBase'       </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getFormatNum(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBase'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">], </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseNoRent' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getFormatNum(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseNoRent'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">], </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseRent'   </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getFormatNum(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseRent'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">], </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBaseNoNds'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBaseNoNds'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBase'     </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBase'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'discount'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'discount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSum'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSum'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">])<br />    ]<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private void </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getCalculation(ContractPosition position, LinkedHashMap&lt;Object, Object&gt; calculation, SimpleDateFormat df, BigDecimal totalVolumePosition, TreeMap&lt;Object, Object&gt; accrualsGroup, contract, String realEstateNums, isFact) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getCategory() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'unitName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = position.getUnit().getName()<br />    }<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getNorm() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'norm'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = getFormatNum(position.getNorm(), </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">4</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    }<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getWasteProject() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'unitName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;ПНООЛР с </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">$</span><span style=" font-family:'DejaVu Sans Mono'; font-weight:600; color:#a9b7c6;">{</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">position.getWasteProject().getValidityFrom() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'--' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: df.format(position.getWasteProject().getValidityFrom())</span><span style=" font-family:'DejaVu Sans Mono'; font-weight:600; color:#a9b7c6;">}</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;"> по </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">$</span><span style=" font-family:'DejaVu Sans Mono'; font-weight:600; color:#a9b7c6;">{</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">position.getWasteProject().getValidityTo() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'--' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: df.format(position.getWasteProject().getValidityTo())</span><span style=" font-family:'DejaVu Sans Mono'; font-weight:600; color:#a9b7c6;">}</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br /><br />    calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = getFormatNum(totalVolumePosition, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Нужен среднее кол-во р/е по позиции, или объем деленый на норматив<br />    //Вычисляем актуальное начисление на в зависимости от даты договора<br />    //    def nMouth = accrualsGroup.size() == 12 ? contract.getDate().getMonth()-1 : 0<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">nMouth = accrualsGroup.size() - (</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">12 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">- contract.getDate().getMonth())<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//    if(accrualsGroup.values()[nMouth]) calculation['calculationAmount'] = getFormatNum(accrualsGroup.values()[nMouth]['calculationAmount'], 5)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">calculationAmount = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getCalculationAmount() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">|| position.getCalculationAmount() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getContragentRealEstate() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />            calculationAmount = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;--&quot;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">} </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />            calculationAmount = getFormatNum(dataManager.reload(position.getContragentRealEstate(), </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;_local&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).getCalculationAmount(), </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />        }<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        calculationAmount = getFormatNum(position.getCalculationAmount(), </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    }<br />    calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = calculationAmount<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getNorm() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />        calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmountPay'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = getFormatNum(accrualsGroup.values()[nMouth][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">], </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmountPay'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = position.getNorm() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getFormatNum(totalVolumePosition / </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal(position.getNorm()), </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">3</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(position.getContragentRealEstate() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmountPay'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;--&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'n'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = realEstateNums<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(isFact) {<br />        calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'unitName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'Вывоз по факту'<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'norm'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'--'<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'--'<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">calculation[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'--'<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//        calculation['n'] = calculations.size()+1<br />//        calculations.push(calculation)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private void </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">fillRentersGroup(Accrual accrual, TreeMap&lt;Object, Object&gt; rentersGroup) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">rentCategory = dataManager.load(RealEstateCategory.</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">class</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .query(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'select a.category from rtneo$Accrual a where a.id=:id'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .parameter(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'id'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, accrual.getId())<br />            .view(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'_local'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .optional()<br />            .orElse(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(rentersGroup[rentCategory.getName()] == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        rentersGroup[rentCategory.getName()] = [<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentCategory'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: rentCategory.getName(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentArea'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: accrual.getCalculationAmount(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentNorm'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: rentCategory.getNorm(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentAmount'  </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: accrual.getAmountBase()];<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        rentersGroup[rentCategory.getName()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentArea'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += accrual.getCalculationAmount();<br />        rentersGroup[rentCategory.getName()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentAmount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += accrual.getAmountBase();<br />    }<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">LinkedHashMap&lt;String, Object&gt; getRequisites(contract, LinkedHashMap&lt;Object, Object&gt; params, SimpleDateFormat df, String startFrom, Contragent contragent) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">companyService = AppBeans.get(CompanyService.NAME)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">bankDataService = AppBeans.get(BankDataSupplierService.NAME)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Получаем реквизиты компании, действующие на момент даты договора<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">company = contract.getCompany()<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">companyRequisites = companyService.getCompanyRequisites(company, contract.getDate())<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">companyManagerNameR = companyRequisites.getManagerName()<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">try </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        companyManagerNameR = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">RussianName(companyManagerNameR).fullName(RussianNameProcessor.gcaseRod)<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">catch </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(e) {<br /><br />    }<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//заполняем шапку<br /><br />//документ-основание<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">contragentPersonReasonText = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">', действующего на основании '<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragent.getType() == ContragentType.PERSONAL) {<br />        contragentPersonReasonText = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />    contragentPersonReasonDoc = params[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'personReason'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragentPersonReasonDoc == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        contragentPersonReasonDoc = contragent.getHeadPersonReasonDoc()<br />    }<br />    contragentPersonReasonDocR = contragentPersonReasonDoc<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">try </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        contragentPersonReasonDocR = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">RussianName(contragentPersonReasonDoc).fullName(RussianNameProcessor.gcaseRod)<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">catch </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(e) {<br /><br />    }<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragentPersonReasonDocR == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(getContragentType(contragent) == ContragentType.ORGANISATION) {<br />            contragentPersonReasonDocR = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;устава&quot;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">} </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(getContragentType(contragent) == ContragentType.INDIVIDUAL) {<br />            contragentPersonReasonDocR = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;свидетельства / выписки о государственной регистрации в качестве индивидуального предпринимателя&quot;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />    }<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//подписант<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">contragentPersonName = params[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'personName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragentPersonName == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        contragentPersonName = contragent.getHeadPersonName()<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragent.getType() == ContragentType.PERSONAL) {<br />            contragentPersonName = contragent.getName()<br />        }<br />    }<br />    contragentPersonNameR = contragentPersonName<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">try </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        contragentPersonNameR = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">RussianName(contragentPersonName).fullName(RussianNameProcessor.gcaseRod)<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">catch </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(e) {<br /><br />    }<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//должность подписанта<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">contragentPersonPost = params[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'personPost'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragentPersonPost == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        contragentPersonPost = contragent.getHeadPersonPost()<br />    }<br />    contragentPersonPostR = contragentPersonPost<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">try </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        contragentPersonPostR = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">RussianName(contragentPersonPost).fullName(RussianNameProcessor.gcaseRod)<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">catch </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(e) {<br /><br />    }<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//массив шапочных параметров<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props = [<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'number'                       </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contract.getNumber(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'date'                         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getTextDate(contract.getDate()),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'dateFromTKO'                  </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: df.format(contract.getFrom()),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'dateBeforeTKO'                </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: df.format(contract.getBefore()),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentName'               </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getName(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentNameShort'          </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getShortName(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonName'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragentPersonName,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonNameR'        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragentPersonNameR,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonNameShort'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getShortFio(contragentPersonName),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonPost'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragentPersonPost,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonPostR'        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragentPersonPostR,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonReasonDoc'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragentPersonReasonDoc,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonReasonDocR'   </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragentPersonReasonDocR,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentPersonReasonText'   </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragentPersonReasonText,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'contragentShortName'          </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getShortName(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'legalAddress'                 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getLegalAddress(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'actualAddress'                </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getActualAddress(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'mailingAddress'               </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getMailingAddress(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'registrationAddrees'          </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getRegistrationAddress(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'passportSeries'               </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getPassportSeries(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'passportNumber'               </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getPassportNumber(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'passportGivenDate'            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getPassportGivenDate(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'inn'                          </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getInn(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'kpp'                          </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getKpp(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ogrn'                         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getOgrn(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'checkingAccount'              </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getCheckingAccount(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'bankName'                     </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getBankName(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'correspondentAccount'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getCorrespondentAccount(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'bik'                          </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: contragent.getBik()<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyShortName'           </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: company.shortName<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyFullName'            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: company.fullName<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyInn'                 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: company.inn<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyEmail'               </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: company.email<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyOgrn'                </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: company.ogrn<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyPhone'               </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: company.phone<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyLegalAddress'        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.legalAddress<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyActualAddress'       </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.actualAddress<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyPostalAddress'       </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.postalAddress<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyKpp'                 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.kpp<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyBankName'            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.bankName<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyBankAccount'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.bankAccount<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyCorrespondentAccount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.correspondentAccount<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyRcbic'               </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.rcbic<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyManagerTitle'        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.managerTitle<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyManagerTitleR'       </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.managerTitleR<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyManagerName'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyRequisites.managerName<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyManagerNameR'        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: companyManagerNameR<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyManagerNameShort'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getShortFio(companyRequisites.managerName)<br />            , </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'companyManagerDocumentR'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getShortFio(companyRequisites.managerDocumentR),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'startFrom'                    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: startFrom<br />    ]<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!StringUtils.isBlank(props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'bik'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]) &amp;&amp; (StringUtils.isBlank(props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'bankName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]) || StringUtils.isBlank(props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'correspondentAccount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]))) {<br />        BankData bank = bankDataService.getSuggestionBankDetails(props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'bik'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">])<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(bank != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(StringUtils.isBlank(props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'bankName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">])) {<br />                props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'bankName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = bank.getName()<br />            }<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(StringUtils.isBlank(props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'correspondentAccount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">])) {<br />                props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'correspondentAccount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = bank.getCorrespondentAccount()<br />            }<br />        }<br />    }<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//телефон + почта<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">phone = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragent.getHeadPersonPhone() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        phone = contragent.getHeadPersonPhone()<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragent.getContactPersonPhone() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        phone = contragent.getContactPersonPhone()<br />    }<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">email = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragent.getHeadPersonEmail() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        email = contragent.getHeadPersonEmail()<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contragent.getContactPersonEmail() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        email = contragent.getContactPersonEmail()<br />    }<br />    props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'phone'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = phone<br />    props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'email'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = email<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy 19-07-19/--<br />//В пункте 3 доп соглашения, указываем начало действия доп соглашения<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'dateFrom'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = getTextDate(contract.getFrom())<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy 19-07-19--/<br />//получаем номер и дату головного договора<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contract.getMainContract() != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'mainContractNumber'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = contract.getMainContract().getNumber()<br />        props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'mainContractDate'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = getTextDate(contract.getMainContract().getDate())<br />    }<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//вычисляем подписантов и юридический адрес<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">defaultDate = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">Date().copyWith(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">year</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2019</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">month</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">JANUARY</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">dayOfMonth</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">17</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">hourOfDay</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">minute</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">second</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">addressChangeDate = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">Date().copyWith(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">year</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2019</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">month</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">APRIL</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">dayOfMonth</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">26</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">hourOfDay</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">minute</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">second</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">contractDate = contract.getDate()<br />    props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourPersonPost'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;Заместитель генерального директора по коммерческой работе&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourPersonPostR'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;Заместителя генерального директора по коммерческой работе&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourPersonName'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;Степанова Татьяна Анатольевна&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourPersonNameR'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;Степановой Татьяны Анатольевны&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourPersonReasonDoc'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;доверенность № РТ-05 от 11.01.2019 г&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourPersonReasonDocR'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;доверенности № РТ-05 от 11.01.2019 г&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourPersonNameShort'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;Степанова Т.А.&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(contractDate &lt; addressChangeDate) {<br />        props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourLegalAddress'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'308000, Белгородская область, город Белгород, проспект Б. Хмельницкого, дом 131, помещение 15'<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourKpp'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'312301001'<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">} </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourLegalAddress'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'664033, Иркутская область, город Иркутск, улица Лермонтова, дом 337Б, помещение 8'<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ourKpp'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'381201001'<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">props<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private void </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">createAccrualsGroup(TreeMap&lt;Object, Object&gt; accrualsGroup, Accrual accrual, </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">boolean </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isCnC, </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">boolean </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isPayLandlord) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(accrualsGroup[accrual.getPeriod()] == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        accrualsGroup[accrual.getPeriod()] = [<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'period'           </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getTextPeriod(accrual.getPeriod()),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'tariff'           </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: round(getNN(accrual.getPrice()) * </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">/ </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">6</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBase'       </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: !isCnC &amp;&amp; isPayLandlord ? BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNN(accrual.getAmountBase()),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseNoRent' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: !isCnC ? getNN(accrual.getAmountBase()) : BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseRent'   </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: isCnC &amp;&amp; isPayLandlord ? getNN(accrual.getAmountBase()) : BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBaseNoNds'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: (getNN(accrual.getTotalSumBase()) - getNN(accrual.getNdsSumBase())),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//'totalSumBaseNoNds': (getNN(accrual.getAmountBase())*getNN(tariffNoNDS)),<br />                //a.kotvinskiy --/<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBase'     </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNN(accrual.getTotalSumBase()),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'discount'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNN(accrual.getTotalSumBase()) - getNN(accrual.getTotalSum()),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSum'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNN(accrual.getTotalSum()),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNN(accrual.getCalculationAmount())]<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBase'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += !isCnC &amp;&amp; isPayLandlord ? BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNN(accrual.getAmountBase());<br />        accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseNoRent'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += !isCnC ? getNN(accrual.getAmountBase()) : BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'amountBaseRent'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += isCnC &amp;&amp; isPayLandlord ? getNN(accrual.getAmountBase()) : BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBaseNoNds'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += (getNN(accrual.getTotalSumBase()) - getNN(accrual.getNdsSumBase()));<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//accrualsGroup[accrual.getPeriod()]['totalSumBaseNoNds']+=(getNN(accrual.getAmountBase())*getNN(tariffNoNDS));<br />        //a.kotvinskiy --/<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSumBase'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += getNN(accrual.getTotalSumBase());<br />        accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'discount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += (getNN(accrual.getTotalSumBase()) - getNN(accrual.getTotalSum()));<br />        accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'totalSum'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] += getNN(accrual.getTotalSum());<br />        accrualsGroup[accrual.getPeriod()][</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'calculationAmount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = getNN(accrual.getCalculationAmount());<br />    }<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private void </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getContainers(containerYard, isFact, List containers, String startFrom, String endBefore) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">containerWasteBuff = [:]<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContainerWaste container : containerYard.getContainers()) {<br />        String type = container.getType()?.getName() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: container.getType().getName()<br />        String volume = container.getType()?.getVolume() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: getNumber(container.getType().getVolume(), </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />        volume = volume.replaceAll(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">','</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'.'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />        Integer count = container.getCount() == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: container.getCount();<br /><br />        String typeVal = type + volume<br />        String key = containerYard.getCode()<br /><br /><br />        String typeExport = isFact ? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'Исходя из количества и объема контейнеров' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'Исходя из нормативов накопления'<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current = []<br />        Map previous = containerWasteBuff[key]<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//                    if (previous == null) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current = [<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'n'         </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: containers.size() + </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">1</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'code'      </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: containerYard.getCode(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'startFrom' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: startFrom,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'endBefore' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: endBefore,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'address'   </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: containerYard.getAddress(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'longitude' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: containerYard.getLongitude(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'latitude'  </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: containerYard.getLatitude(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'typeExport'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: typeExport,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'owner'     </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: containerYard.getOwner(),<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'type'      </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: type,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'volume'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: volume,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'count'     </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: count,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'typeWaste' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: ((volume != </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) &amp;&amp; (</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">BigDecimal(volume) &lt; </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5.0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)) ? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ТКО' </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'КГО'<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//                        log.debug(previous['code'])<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(containerWasteBuff[key] != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//                            if(current['n'] == )<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'n'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'code'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'startFrom'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'endBefore'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'address'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'longitude'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'latitude'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">current[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'owner'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />        containers.push(current)<br />        containerWasteBuff[key] = current<br />    }<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">private </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">List getRenters(TreeMap&lt;Object, Object&gt; rentersGroup) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">renters = []<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(item </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">in </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">rentersGroup) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">renter = [<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentCategory'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentCategory'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">],<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentArea'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentArea'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] / </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">12</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentNorm'    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentNorm'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">],<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentAmount'  </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: item.getValue()[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'rentAmount'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">],<br />        ]<br />        renters.push(renter)<br />    }<br />    renters<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//получить дату словами<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getTextDate(Date date) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">result=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">monthesRP = [</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'января'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'февраля'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'марта'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'апреля'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'мая'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'июня'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'июля'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'августа'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'сентября'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'октября'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ноября'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'декабря'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    Calendar cal = Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">getInstance</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">()<br />    cal.setTime(date);<br />    result = cal.get(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">DAY_OF_MONTH</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).toString()<br />    result+=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot; &quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">+monthesRP[cal.get(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">MONTH</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)]<br />    result+=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot; &quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">+cal.get(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">YEAR</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).toString()+</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot; г.&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">result<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//получить период словами<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getTextPeriod(Date date) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">result=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">monthesRP = [</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'январь'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'февраль'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'март'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'апрель'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'май'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'июнь'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'июль'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'август'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'сентябрь'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'октябрь'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'ноябрь'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">,</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'декабрь'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">]<br />    Calendar cal = Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">getInstance</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">()<br />    cal.setTime(date);<br />    result+=monthesRP[cal.get(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">MONTH</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)]<br />    result+=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot; &quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">+cal.get(Calendar.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">YEAR</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).toString()+</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot; г.&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">result<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//форматирование чисел<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getNumber(BigDecimal number, </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">boolean </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">money = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">true</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">boolean </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">scale = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(number == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;-&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />    DecimalFormatSymbols symbols = DecimalFormatSymbols.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">getInstance</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">()<br />    symbols.setGroupingSeparator((</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">char</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">' '</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    symbols.setDecimalSeparator((</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">char</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">','</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(money){<br />        DecimalFormat formatter = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">DecimalFormat(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###.00'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, symbols)<br />        String result = formatter.format(number);<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">result.startsWith(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;,&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) ? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;0&quot; </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">+ result : result;<br />    } </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Временное решение чтобы, вывести норматив. 4 знака после запятой<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(scale){<br />            DecimalFormat formatter = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">DecimalFormat(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###.####'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, symbols)<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">formatter.format(number);<br />        }</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />            DecimalFormat formatter = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">DecimalFormat(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###.###'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, symbols)<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">formatter.format(number);<br />        }<br /><br />    }<br />}<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy /--<br />//Временное решение, по формату отображения нулей после запятой<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getFormatNum(BigDecimal number, </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">int </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">s, </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">boolean </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">money = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(number == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) {<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;-&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />    String formatString = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">''</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br /><br />    DecimalFormatSymbols symbols = DecimalFormatSymbols.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">getInstance</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">()<br />    symbols.setGroupingSeparator((</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">char</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">' '</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    symbols.setDecimalSeparator((</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">char</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">','</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">switch</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(s){<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">case </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">1</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:<br />            formatString = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###,###.#'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">break</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">case </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:<br />            formatString = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###,###.##'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">break</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">case </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">3</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:<br />            formatString = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###,###.###'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">break</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">case </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">4</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:<br />            formatString = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###,###.####'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">break</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">case </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">5</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:<br />            formatString = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'###,###,###.######'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">break</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />    }<br />    DecimalFormat formatter = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">DecimalFormat(formatString, symbols);<br />    String result = formatter.format(number);<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">result.startsWith(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;,&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) ? </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;0&quot; </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">+ result : result;<br />}<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//a.kotvinskiy --/<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getShortFio(String fio) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(fio == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;&quot;<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">String pattern = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">\\</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">S+</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">\\</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">s)(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">\\</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">S{1})</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">\\</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">S+</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">\\</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">s(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">\\</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">S{1})</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">\\</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">S+'<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">String str = fio.replaceAll(pattern, </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'$1$2.$3.'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">str<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">round(BigDecimal sum){<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">sum == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: sum.setScale(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">2</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, RoundingMode.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">HALF_UP</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">);<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getContragentType(Contragent contragent) {<br />    String name = contragent.getName();<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(name == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />        name = contragent.getShortName();<br />    }<br />    String inn = contragent.getInn();<br />    ContragentType type = contragent.getType();<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!StringUtils.isEmpty(name)) {<br />        name = name.toLowerCase().trim();<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(name.startsWith(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;ип &quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) || name.endsWith(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot; ип&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) ||<br />                name.contains(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot; ип &quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) ||<br />                name.contains(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;инд.предп.&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">) ||<br />                name.contains(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;индивидуальный предприниматель&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)) {<br />            type = ContragentType.INDIVIDUAL;<br />        }<br />    }<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">type;<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">getNN(BigDecimal value) {<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">value == </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">? BigDecimal.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">ZERO </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">: value;<br />}<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">isPayLandLord(ContragentRealEstate cre){<br />    List&lt;RealEstateRenter&gt; rr = dataManager.load(RealEstateRenter)<br />            .query(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'select r from rtneo$RealEstateRenter r where r.renterRecord.id = :id and r.payOwner = true'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .parameter(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;id&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, cre.getId())<br />            .view(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;_local&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .list();<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(rr.size()&gt;</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return true else return false</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">;<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//**************************************************************<br />//Получить КП для печати<br />//Нужно разделить(на 3. логика выбор! создание)<br />//**************************************************************<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">List&lt;HashMap&lt;String, Object&gt;&gt; getHistoryPrintItemsCY(List&lt;ContractPositionContainerYard&gt; cpcyHistory, Integer startCount){<br />    SimpleDateFormat df = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">SimpleDateFormat(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;dd.MM.yyyy&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    HashMap&lt;String, Object&gt; cyHash = [:]<br />    List&lt;HashMap&lt;String, Object&gt;&gt; cyItemList = []<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">char </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">nChar = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'А'<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">nInt = Double.</span><span style=" font-family:'DejaVu Sans Mono'; font-style:italic; color:#9876aa;">valueOf</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(startCount)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">n = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null<br /><br />    def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevCode = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null<br />    def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevFrom = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null<br />    def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevBefore = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null<br />    def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevCre = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null<br />    def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevCP = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null<br /><br />    def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevN = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null<br />    char </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevNChar = nChar<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevNInt = nInt<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContractPositionContainerYard cpcy : cpcyHistory){<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">changeCY = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false<br />        def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">changeCre = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">false<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Логика выбора<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!prevCode.equals(cpcy.getContainerYard().getCode())){<br />            changeCY = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">true<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//        log.debug(&quot;${prevCre}&quot;)<br />//        if(prevCre != null){log.debug(&quot;--${prevCre.getCalculationAmount()} ${cpcy.getContractPosition().getContragentRealEstate().getCalculationAmount()}&quot;)}<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(prevCre != </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">&amp;&amp; (prevCre.getCalculationAmount() != cpcy.getContractPosition().getContragentRealEstate().getCalculationAmount())){<br />            changeCre = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">true<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!prevCre.equals(cpcy.getContractPosition().getContragentRealEstate())){<br />            changeCre = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">true<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(!changeCre &amp;&amp; !changeCY)</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">continue<br /><br />        if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(prevFrom.equals(cpcy.getContractPosition().getContract().getFrom())){<br /><br />            cyItemList.remove(cyItemList.size()-</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">1</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            n = prevN<br /><br />        }</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Получение номера вынести в отдельный метод<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(changeCY &amp; !changeCre){<br />                n = nChar++<br />            }<br /><br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(changeCre){<br />                nChar = </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'А'<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(nInt%</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">1 </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">== </span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0.0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">){<br />                    n = nInt<br />                    nInt +=</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0.1<br />                </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">else</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">{<br />                    n = nInt<br />                }<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//                nInt +=0.1<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(cyItemList.size()&gt;</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">0</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)cyItemList.get(cyItemList.size()-</span><span style=" font-family:'DejaVu Sans Mono'; color:#6897bb;">1</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)[</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;endBefore&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">] = df.format(cpcy.getContractPosition().getContract().getFrom())<br />        }<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">pos = createContainerItem(cpcy, n, df.format(cpcy.getContractPosition().getContract().getFrom()), df.format(cpcy.getContractPosition().getContract().getBefore()))<br /><br />        cyItemList.push(pos)<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Устанавливаем предыдущие значения<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevCode = cpcy.getContainerYard().getCode()<br />        prevFrom = cpcy.getContractPosition().getContract().getFrom()<br />        prevBefore = cpcy.getContractPosition().getContract().getBefore()<br />        prevCre = cpcy.getContractPosition().getContragentRealEstate()<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//            if(!isPrevN)prevN = n<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">prevN = n<br />        prevNChar = nChar<br />        prevNInt = nInt<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//Конец выбора<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">}<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//log.debug(cyItemList)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">cyItemList<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//**************************************************************<br />//Получить историю КП для объекта<br />//**************************************************************<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">List&lt;ContractPositionContainerYard&gt; getHistoryCY(Contragent contragent, ContractPosition contractPosition){<br />    List&lt;ContractPosition&gt; cpList = getHistoryCP(contragent, contractPosition)<br />    List&lt;ContractPositionContainerYard&gt; cpcyList = []<br /><br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContractPosition cp : cpList){<br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContractPositionContainerYard cpcy : cp.getContainerYards()){<br />            cpcyList.push(cpcy)<br />        }<br />    }<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">cpcyList<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//**************************************************************<br />//Получить историю позиции договора<br />//**************************************************************<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">List&lt;ContractPosition&gt; getHistoryCP(Contragent contragent, ContractPosition cp){<br />    DataManager dataManager = AppBeans.get(DataManager.NAME);<br />    EntitySnapshotService entitySnapshotService = AppBeans.get(EntitySnapshotService.NAME);<br /><br />    List&lt;SnapshotHistory&gt; listSnapshotHistory = dataManager.load(SnapshotHistory.</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">class</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .query(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">'select s from rtneo$SnapshotHistory s where s.contragent.id = :contragent and s.contract.accepted = true order by s.contract.createTs asc'</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .parameter(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;contragent&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">, contragent.getId())<br />            .view(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;_local&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />            .list();<br /><br />    List&lt;ContractPosition&gt; cpList = []<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">snapshotHistory : listSnapshotHistory){<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">entitySnapshot = dataManager.load(EntitySnapshot.</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">class</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">).id(snapshotHistory.getSnapshot()).optional().orElse(</span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">null</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />        Contract entity = entitySnapshotService.extractEntity(entitySnapshot)<br /><br />        </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">for</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(ContractPosition cpItem : entity.getPositions()){<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">if</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">(cp.getContragentRealEstate().getId() == cpItem.getContragentRealEstate().getId())<br />                cpList.push(cpItem)<br />        }<br /><br />    }<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">cpList;<br />}<br /><br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">createContainerItem(ContractPositionContainerYard cpcy, Object n, String from, String before){<br />    SimpleDateFormat df = </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">new </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">SimpleDateFormat(</span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">&quot;dd.MM.yyyy&quot;</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">def </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">pos = [<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">realEstateName</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:cpcy.getContractPosition().getContragentRealEstate().getRealEstate().getName(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">cadastralNumber</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:cpcy.getContractPosition().getContragentRealEstate().getRealEstate().getCadastralNumber(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">address</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:cpcy.getContractPosition().getContragentRealEstate().getRealEstate().getAddress(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">startFrom</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:from,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">endBefore</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:before,<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">containerYardNumber</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:cpcy.getContainerYard().getCode(),<br />            </span><span style=" font-family:'DejaVu Sans Mono'; color:#6a8759;">n</span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">:n<br />    ]<br /></span><span style=" font-family:'DejaVu Sans Mono'; color:#808080;">//    log.debug(pos)<br />    </span><span style=" font-family:'DejaVu Sans Mono'; color:#cc7832;">return </span><span style=" font-family:'DejaVu Sans Mono'; color:#a9b7c6;">pos<br />}</span></pre></body></html>