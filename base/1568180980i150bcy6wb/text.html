<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import com.haulmont.cuba.core.global.*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import com.groupstp.rtneo.entity.*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import com.groupstp.rtneo.core.bean.tools.DatePeriodTools</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import java.text.SimpleDateFormat</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import com.groupstp.rtneo.core.bean.calculation.CalculationWorkerHelper</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import java.util.*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import com.haulmont.cuba.core.global.ViewRepository;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">log.debug(&quot;createSupplementaryAggrements.START&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//a.kotvinskiy /--</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//Программное создание view</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">ViewRepository vRep = AppBeans.get(ViewRepository.NAME)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">View contractView = vRep.getView(Contract.class, &quot;_minimal&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contractView.addProperty(&quot;number&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contractView.addProperty(&quot;contragent&quot;, vRep.getView(Contragent.class, &quot;_minimal&quot;));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contractView.addProperty(&quot;positions&quot;, vRep.getView(ContractPosition.class, &quot;_minimal&quot;));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contractView.addProperty(&quot;supplementaryAgreements&quot;, vRep.getView(Contract.class, &quot;_minimal&quot;));</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">View contractPositionView = vRep.getView(ContractPosition.class, &quot;_minimal&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contractPositionView.addProperty(&quot;relevance&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contractPositionView.addProperty(&quot;volumeYear&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contractPositionView.addProperty(&quot;accruals&quot;, vRep.getView(Accrual.class, &quot;_minimal&quot;));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//a.kotvinskiy --/</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//здесь, в переменную price нужно указать тариф, тестовое значение = 500</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//BigDecimal price = 464.8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//Если contractId &quot;&quot;, то доп генерируется для всех</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">String contractId = &quot;7114ec94-6d49-14d1-c66e-d98e6b77d891&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">SimpleDateFormat format = new SimpleDateFormat(&quot;dd.MM.yyyy&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">Date fromDate = format.parse(&quot;01.01.2019&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">Date beforeDate = format.parse(&quot;31.12.2019&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">Date contract_date = format.parse(&quot;01.01.2019&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">DataManager dataManager = AppBeans.get(DataManager.NAME)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">Metadata metadata = AppBeans.get(Metadata.NAME)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">String tableNameCompany = metadata.getClassNN(Company.class).getName()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">String tableNameContract = metadata.getClassNN(Contract.class).getName()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">CommitContext commitContext = new CommitContext()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">List&lt;Company&gt; listCompany = dataManager.load(Company.class)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .query(&quot;select comp from &quot; + tableNameCompany + &quot; comp&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .view(&quot;_minimal&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .list()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">Company company = listCompany.size() == 1 ? listCompany.get(0) : null</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">List&lt;Contract&gt; list = dataManager.load(Contract.class)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .query(&quot;select c from &quot; + tableNameContract + &quot; c where c.loadedFromBigTrio = true&quot; + new StringBuilder(contractId != &quot;&quot; ? &quot; and c.id = '${contractId}'&quot; : &quot;&quot;).toString())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .view(contractView)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .list()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">log.debug(&quot;Будет обработано &quot; + list.size() + &quot; договоров, загруженных из BigTrio&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">def numContract = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">def numContractPosition = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">def numAccrual = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">for (Contract baseContract : list) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //if (numContract == 1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //    break</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    log.debug((numContract + 1) + &quot;) Договор № &quot; + baseContract.getNumber())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    Contragent contragent = baseContract.getContragent()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    Contract contract = new Contract()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setDate(new Date())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setFrom(fromDate)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setBefore(beforeDate)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //a.kotvinskiy</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setNumber(&quot;${baseContract.getSupplementaryAgreements().size()+1}&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setCompany(company)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setContragent(contragent)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setMainContract(baseContract)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    contract.setPositions(new ArrayList&lt;&gt;())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    commitContext.addInstanceToCommit(contract)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    log.debug(&quot;Доп. соглашение $contract.id добавлено в CommitContext&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    numContract = numContract + 1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //для каждой позиции в base-договоре</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    for (ContractPosition baseContractPosition : baseContract.getPositions()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        baseContractPosition = dataManager.reload(baseContractPosition, contractPositionView)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        ContractPosition contractPosition = new ContractPosition()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        contractPosition.setVolumeYear(baseContractPosition.getVolumeYear())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        contractPosition.setPeriod(contract_date)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        contractPosition.setContract(contract)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        contractPosition.setRelevance(baseContractPosition.getRelevance())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        contractPosition.setContragent(contragent)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        contractPosition.setAccruals(new ArrayList&lt;&gt;())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        commitContext.addInstanceToCommit(contractPosition)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        log.debug(&quot;ContractPosition $contractPosition.id добавлена в CommitContext&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        numContractPosition = numContractPosition + 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        contract.getPositions().add(contractPosition)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        //расчет начислений</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        List&lt;Accrual&gt; listAccruals = calculateAccruals(fromDate,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                beforeDate,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                new Date(),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                contractPosition,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                price)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        for (Accrual accrual:listAccruals)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            commitContext.addInstanceToCommit(accrual)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            log.debug(&quot;Accrual $accrual.id добавлена в CommitContext&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            numAccrual = numAccrual + 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            contractPosition.getAccruals().add(accrual)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //делаем неактивным допик</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //makeContractObsolete(contract, false);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //снова делаем активным последний договор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //makeContractObsolete(lastContract, true);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">log.debug(&quot;Запись изменений в БД...&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">dataManager.commit(commitContext)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">log.debug(&quot;Всего создано:\nДоп.соглашений: &quot; + numContract + &quot;\nContractPosition: &quot; + numContractPosition + &quot;\nAccruals: &quot; + numAccrual)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">log.debug(&quot;createSupplementaryAggrements.FINISH&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//возвращает список начислений по переданной позици договора и указанной цене</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">List&lt;Accrual&gt; calculateAccruals(Date from, Date to, Date billDate, ContractPosition position, BigDecimal price) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    DatePeriodTools datePeriodTools = AppBeans.get(DatePeriodTools.class)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    CalculationWorkerHelper helper = AppBeans.get(CalculationWorkerHelper.class)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    from = from == null ? new Date() : from</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    to = to == null ? from : to</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    billDate = billDate == null ? new Date() : billDate</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    List&lt;Accrual&gt; result = new ArrayList&lt;&gt;()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    try {</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        Calendar calendarFrom = datePeriodTools.getFirstDayOfMonth(from)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        Calendar calendarTo = datePeriodTools.getFirstDayOfMonth(to)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        while ((calendarFrom.get(Calendar.YEAR) == calendarTo.get(Calendar.YEAR) &amp;&amp;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                calendarFrom.get(Calendar.MONTH) &lt;= calendarTo.get(Calendar.MONTH)) ||</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                (calendarFrom.get(Calendar.YEAR) &lt; calendarTo.get(Calendar.YEAR))) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            int documentNumber = helper.getNextAccrualNumber()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            Date period = calendarFrom.getTime()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//Выбираем тариф в зависимости от периода</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">price = calendarFrom.get(Calendar.MONTH)&gt;5?464.8:435.74</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            Accrual accrual</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            try {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                accrual = calculateAverage(position, period, documentNumber, billDate, price)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                if (accrual != null)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                    result.add(accrual)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            } catch (Exception e) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                log.error('не удалось создать начисление для ContractPosition: ' + position.getId())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            calendarFrom.add(Calendar.MONTH, 1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    finally {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        log.debug('Расчет начислений окончен')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    return result</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">//расчет по-среднему</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">Accrual calculateAverage(ContractPosition position, Date period, int documentNumber, Date billDate, BigDecimal price) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    CalculationWorkerHelper helper = AppBeans.get(CalculationWorkerHelper.class)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    BigDecimal norm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    if (position.getVolumeYear() != null &amp;&amp; position.getVolumeYear() != BigDecimal.ZERO)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        norm = helper.divide(position.getVolumeYear(), BigDecimal.valueOf(12))</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    BigDecimal tariff = price</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    tariff = helper.addNdsTo(tariff)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    BigDecimal sum = helper.multiply(norm, tariff)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    BigDecimal totalSum = sum</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    BigDecimal ndsSum = helper.getNdsFrom(sum)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //a.kotvinskiy Объем ТКО в месяц</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    BigDecimal amountBase = position.getVolumeYear()/12</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    Accrual accrual = new Accrual()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setContractPosition(position)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setPeriod(period)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setContragent(position.getContragent())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setAmount(norm)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //a.kotvinskiy /--</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    // Недостающие атрибуты</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setAmountBase(amountBase)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setTotalSumBase(totalSum)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setNdsSumBase(totalSum-price.multiply(amountBase))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    //a.kotvinskiy --/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setPrice(tariff)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setReductionFactor(BigDecimal.ONE)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setZoneRatio(BigDecimal.ONE)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setNds(BigDecimal.valueOf(20))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setSum(sum)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setTotalSum(totalSum)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setNdsSum(ndsSum)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setComment('По-среднему')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setDebugComment('')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setDocumentNumber(documentNumber)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    accrual.setDocumentDate(billDate)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    return accrual</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">}</span></p></body></html>