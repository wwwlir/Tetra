<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import com.groupstp.rtneo.entity.*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">import com.haulmont.cuba.core.global.*</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">DataManager dataManager = AppBeans.get(DataManager.NAME)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">ViewRepository vRep = AppBeans.get(ViewRepository.NAME)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">View realEstateView = vRep.getView(RealEstate.class, '_base');</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">realEstateView.addProperty(&quot;contragents&quot;);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">View contragentRealEstateView = vRep.getView(ContragentRealEstate.class, '_base');</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contragentRealEstateView.addProperty(&quot;contragent&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">contragentRealEstateView.addProperty(&quot;livingArea&quot;);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">def startDate = Date.parse( 'yyyy-MM-dd', '2019-11-10')</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">def reList = dataManager.load(RealEstate.class)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .query('select distinct re from rtneo$RealEstate re join re.contragents c where c.createTs &gt;:dateStart and c.createdBy like \'%dataminer%\' and c.contragent.name like \'%ИРКУТСКАЯ ОБЛАСТНАЯ ИНФЕКЦИОННАЯ КЛИНИЧЕСКАЯ БОЛЬНИЦА%\' order by re.cadastralNumber, re.createTs asc')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .parameter('dateStart', startDate)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .view(realEstateView)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        .list()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">log.debug('Всего ' + reList.size() + ' объектов')</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">for(def re:reList)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    def creInRe = re.contragents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    def previousName = null</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    def previousLivingArea = null</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    def previousINN = null</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    log.debug('re: ' + re.cadastralNumber + ', всего creInRe: ' + creInRe.size())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    for(def cre:creInRe)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        def reloadedCRE = null</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        {</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Lato Heavy'; font-size:12pt; color:#062d91;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            reloadedCRE = dataManager.load(ContragentRealEstate.class)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                    .id(cre.id)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                    .view(contragentRealEstateView)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                    .one()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        catch (e)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        {}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        if(reloadedCRE != null)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            def contragent = reloadedCRE.contragent</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            log.debug('re: ' + re.cadastralNumber + ', cre: ' + reloadedCRE.id + ', ' + contragent.name)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            log.debug(&quot;&gt;&gt; ${contragent.name}=${previousName} AND ${reloadedCRE.livingArea}=${previousLivingArea} AND ${contragent.inn}=${previousINN} &lt;&lt;&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            if(contragent.name.equals(previousName) &amp;&amp; reloadedCRE.livingArea == previousLivingArea &amp;&amp; contragent.inn == previousINN)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                //log.debug('будет удален contragent: ' + contragent.id + ', ' + contragent.name + ', cre ' + reloadedCRE.id)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                    //dataManager.remove(contragent)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                    log.debug('удален contragent: ' + contragent.id + ', ' + contragent.name + ', cre ' + reloadedCRE.id)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                catch(def ex)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                    log.debug('не удалось удалить contragent: ' + contragent.id + ', ' + contragent.name)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            previousName = contragent.name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            previousLivingArea = reloadedCRE.livingArea</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">            previousINN = contragent.inn</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Lato Heavy'; font-size:12pt; color:#062d91;">}</span></p></body></html>