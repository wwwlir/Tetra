<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rest_api_v2_queries_config"></a><span style=" font-size:medium; font-weight:600;">Н</span><span style=" font-size:medium; font-weight:600;">астройка предопределенных JPQL запросов</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В приложении на CUBA предопределенные JPQL запросы должны быть объявлены в файлах, определенных свойством приложения <a href="https://doc.cuba-platform.com/manual-6.10-ru/app_properties_reference.html#cuba.rest.queriesConfig"><span style=" text-decoration: underline; color:#0000ff;">cuba.rest.queriesConfig</span></a>. Свойство должно быть определено в модуле <span style=" font-weight:600;">web</span> или <span style=" font-weight:600;">portal</span> (например, в файле <span style=" font-family:'monospace';">web-app.properties</span>): </p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">cuba.rest.queriesConfig = +com/company/myapp/rest-queries.xml</span> </pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файл <span style=" font-family:'monospace';">rest-queries.xml</span> должен находиться в главном пакете модуля <span style=" font-weight:600;">web</span> или <span style=" font-weight:600;">portal</span> (например, <span style=" font-family:'monospace';">com.company.myapp</span>). Его содержимое определяется схемой <a href="http://schemas.haulmont.com/cuba/6.10/rest-queries.xsd"><span style=" text-decoration: underline; color:#0000ff;">rest-queries.xsd</span></a>, например: </p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">&lt;?xml version=&quot;1.0&quot;?&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">&lt;queries xmlns=&quot;http://schemas.haulmont.com/cuba/rest-queries.xsd&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;query name=&quot;carByVin&quot; entity=&quot;sample$Car&quot; view=&quot;carEdit&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;jpql&gt;&lt;![CDATA[select c from sample$Car c where c.vin = :vin]]&gt;&lt;/jpql&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;params&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            &lt;param name=&quot;vin&quot; type=&quot;java.lang.String&quot;/&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;/params&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;/query&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;query name=&quot;allColours&quot; entity=&quot;sample$Colour&quot; view=&quot;_local&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;jpql&gt;&lt;![CDATA[select u from sample$Colour u order by u.name]]&gt;&lt;/jpql&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;/query&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;query name=&quot;carsByIds&quot; entity=&quot;sample$Car&quot; view=&quot;carEdit&quot; cacheable=&quot;true&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;jpql&gt;&lt;![CDATA[select c from sample$Car c where c.id in :ids]]&gt;&lt;/jpql&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;params&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            &lt;param name=&quot;ids&quot; type=&quot;java.util.UUID[]&quot;/&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;/params&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;/query&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;query name=&quot;myOrders&quot; entity=&quot;sample$Order&quot; view=&quot;orderBrowse&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        &lt;jpql&gt;&lt;![CDATA[select o from sample$Order o where o.createdBy = :session$userLogin]]&gt;&lt;/jpql&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    &lt;/query&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">&lt;/queries&gt;</span> </pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример конфигурирования и исполнения запроса можно увидеть в разделе <a href="https://doc.cuba-platform.com/manual-6.10-ru/rest_api_v2_ex_query_get.html"><span style=" text-decoration: underline; color:#0000ff;">Выполнение JPQL-запроса (GET)</span></a> и <a href="https://doc.cuba-platform.com/manual-6.10-ru/rest_api_v2_ex_query_post.html"><span style=" text-decoration: underline; color:#0000ff;">Выполнение JPQL-запроса (POST)</span></a>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Платформа также предоставляет встроенный запрос <span style=" font-family:'monospace';">all</span> для получения списка всех экземпляров некоторой сущности. Он может быть использован совместно с <span style=" font-family:'monospace';">/count</span> чтобы получить общее количество экземпляров сущности, например: </p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">http://localhost:8080/app/rest/v2/queries/sales$Order/all/count</span> </pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Атрибут <span style=" font-family:'monospace';">cacheable</span> элемента <span style=" font-family:'monospace';">query</span> включает <a href="https://doc.cuba-platform.com/manual-6.10-ru/entity_cache.html"><span style=" text-decoration: underline; color:#0000ff;">кэширование</span></a> данного запроса. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Запрос может содержать предопределенные параметры, которые принимают значения идентификатора и логина текущего пользователя: <span style=" font-family:'monospace';">session$userId</span> и <span style=" font-family:'monospace';">session$userLogin</span>. Их не нужно объявлять в элементе <span style=" font-family:'monospace';">params</span> (см. пример выше). </p></body></html>