<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="file_storage"></a><span style=" font-size:medium; font-weight:600;">Х</span><span style=" font-size:medium; font-weight:600;">ранилище файлов</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хранилище файлов обеспечивает загрузку, хранение и выгрузку произвольных файлов, ассоциированных с сущностями системы. Стандартная реализация сохраняет файлы вне основной базы данных, в специальной структуре файловой системы. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Механизм работы с файлами состоит из следующих частей: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сущность <span style=" font-family:'monospace';">FileDescriptor</span> - описатель загруженного файла (не путать с <span style=" font-family:'monospace';">java.io.FileDescriptor</span>), позволяющий ссылаться на файл из объектов модели данных. </li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Интерфейс <span style=" font-family:'monospace';">FileStorageAPI</span> - доступ к хранилищу файлов на <a href="https://doc.cuba-platform.com/manual-6.10-ru/app_tiers.html"><span style=" text-decoration: underline; color:#0000ff;">уровне</span></a> <span style=" font-weight:600;">Middleware</span>. Основные методы: </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">saveStream()</span> - сохранить содержимое файла, переданное в <span style=" font-family:'monospace';">InputStream</span>, по данным указанного <span style=" font-family:'monospace';">FileDescriptor</span>. </li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">openStream()</span> - вернуть содержимое файла, указанного объектом <span style=" font-family:'monospace';">FileDescriptor</span>, в виде открытого <span style=" font-family:'monospace';">InputStream</span>. </li></ul>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Класс <span style=" font-family:'monospace';">FileUploadController</span> - контроллер Spring MVC, позволяющий отправлять файлы с клиентского уровня на <span style=" font-weight:600;">Middleware</span> посредством HTTP POST запросов. </li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Класс <span style=" font-family:'monospace';">FileDownloadController</span> - контроллер Spring MVC, позволяющий получать файлы с <span style=" font-weight:600;">Middleware</span> на клиентский уровень посредством HTTP GET запросов. </li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Визуальные компоненты <a href="https://doc.cuba-platform.com/manual-6.10-ru/gui_FileUploadField.html"><span style=" text-decoration: underline; color:#0000ff;">FileUpload</span></a> и <a href="https://doc.cuba-platform.com/manual-6.10-ru/gui_FileMultiUploadField.html"><span style=" text-decoration: underline; color:#0000ff;">FileMultiUpload</span></a> - позволяют загрузить файлы с компьютера пользователя на клиентский уровень приложения, и затем организовать их передачу на <span style=" font-weight:600;">Middleware</span>. </li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Интерфейс <span style=" font-family:'monospace';">FileUploadingAPI</span> - промежуточное хранилище загружаемых файлов на клиентском уровне. Используется вышеупомянутыми компонентами для загрузки файлов на клиентский уровень. В прикладном коде используется метод <span style=" font-family:'monospace';">putFileIntoStorage()</span>, перемещающий файл в постоянное хранилище на <span style=" font-weight:600;">Middleware</span>. </li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">FileLoader</span> - интерфейс для работы с хранилищем файлов, предоставляющий единый набор методов как на уровне Middleware, так и на клиентском уровне. </li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">ExportDisplay</span> - интерфейс клиентского уровня, позволяющий выгружать различные ресурсы приложения на компьютер пользователя. Для получения файлов из хранилища можно использовать метод <span style=" font-family:'monospace';">show()</span>, принимающий <span style=" font-family:'monospace';">FileDescriptor</span>. Экземпляр <span style=" font-family:'monospace';">ExportDisplay</span> можно получить либо вызовом статического метода <span style=" font-family:'monospace';">AppConfig.createExportDisplay()</span>, либо <a href="https://doc.cuba-platform.com/manual-6.10-ru/screen_controller_injection.html"><span style=" text-decoration: underline; color:#0000ff;">инжекцией</span></a> в класс контроллера. </li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Передача файлов между пользовательским компьютером и хранилищем в обе стороны производится только путем копирования данных между потоками ввода-вывода. Ни на каком уровне приложения файл не оказывается целиком в памяти, поэтому возможна передача файлов практически любых размеров. </p></td></tr></table></body></html>