<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Фоновые задачи</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://demo.cuba-platform.com/sampler/open?screen=normal-progressbar"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">ДЕМОНСТРАЦИЯ</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Механизм фоновых задач предназначен для асинхронного выполнения длительных операций на клиентском уровне без заморозки пользовательского интерфейса. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Использование фоновых задач: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Задача описывается как наследник абстрактного класса <span style=" font-family:'monospace';">BackgroundTask</span>. В конструктор задачи необходимо передать ссылку на контроллер экрана, с которым будет связана задача, и значение таймаута ее выполнения. </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Если экран указан, то при его закрытии пользователем активная задача будет прервана. Кроме того, задача будет автоматически прервана по истечении указанного таймаута. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Собственно действия, выполняемые задачей, реализуются в методе </span><a href="https://doc.cuba-platform.com/manual-6.10-ru/manual.html#background_tasks_run"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">run()</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">. </span></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создается объект управления задачей − <span style=" font-family:'monospace';">BackgroundTaskHandler</span>. Для этого экземпляр задачи необходимо передать методу <span style=" font-family:'monospace';">handle()</span> бина <span style=" font-family:'monospace';">BackgroundWorker</span>. Ссылку на <span style=" font-family:'monospace';">BackgroundWorker</span> можно получить инжекцией в <a href="https://doc.cuba-platform.com/manual-6.10-ru/manual.html#screen_controller"><span style=" text-decoration: underline; color:#0000ff;">контроллер экрана</span></a>, либо статическим методом класса <span style=" font-family:'monospace';">AppBeans</span>. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполняется запуск задачи. </li></ol>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif'; font-size:9pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Метод </span><span style=" font-family:'monospace'; font-size:9pt;">run()</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> класса </span><span style=" font-family:'monospace'; font-size:9pt;">BackgroundTask</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> нельзя использовать для чтения/изменения состояния визуальных компонентов или источников данных: вместо этого используйте методы </span><span style=" font-family:'monospace'; font-size:9pt;">done()</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt;">progress()</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> и </span><span style=" font-family:'monospace'; font-size:9pt;">canceled()</span><span style=" font-family:'Sans Serif'; font-size:9pt;">. При попытке установить значение для компонента UI из фонового потока будет выброшено исключение </span><span style=" font-family:'monospace'; font-size:9pt;">IllegalConcurrentAccessException</span><span style=" font-family:'Sans Serif'; font-size:9pt;">. </span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Пример: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">@Inject</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">protected BackgroundWorker backgroundWorker;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">@Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">public void init(Map&lt;String, Object&gt; params) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    // Create task with 10 sec timeout and this screen as owner</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    BackgroundTask&lt;Integer, Void&gt; task = new BackgroundTask&lt;Integer, Void&gt;(10, this) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        public Void run(TaskLifeCycle&lt;Integer&gt; taskLifeCycle) throws Exception {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            // Do something in background thread</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            for (int i = 0; i &lt; 5; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                TimeUnit.SECONDS.sleep(1); // time consuming computations</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                taskLifeCycle.publish(i);  // publish current progress to show it in progress() method</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            return null;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        public void canceled() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            // Do something in UI thread if the task is canceled</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        public void done(Void result) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            // Do something in UI thread when the task is done</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        public void progress(List&lt;Integer&gt; changes) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            // Show current progress in UI thread</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    };</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    // Get task handler object and run the task</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    BackgroundTaskHandler taskHandler = backgroundWorker.handle(task);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    taskHandler.execute();</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">} </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Подробная информация о назначении методов приведена в JavaDocs классов </span><span style=" font-family:'monospace'; font-size:9pt;">BackgroundTask</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt;">TaskLifeCycle</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt;">BackgroundTaskHandler</span><span style=" font-family:'Sans Serif'; font-size:9pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Ниже приведены моменты, на которые следует обратить внимание: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">BackgroundTask&lt;T, V&gt;</span> − параметризованный класс: </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">T</span> − тип объектов, показывающих прогресс задачи. Объекты этого типа передаются в метод <span style=" font-family:'monospace';">progress()</span> задачи при вызове <span style=" font-family:'monospace';">TaskLifeCycle.publish()</span> в рабочем потоке. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">V</span> − тип результата задачи, он передается в метод <span style=" font-family:'monospace';">done()</span>. Его также можно получить вызовом метода <span style=" font-family:'monospace';">BackgroundTaskHandler.getResult()</span>, что приведет к ожиданию завершения задачи. </li></ul>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Метод <span style=" font-family:'monospace';">canceled()</span> вызывается только в случае управляемой отмены задачи, то есть при вызове <span style=" font-family:'monospace';">cancel()</span> у <span style=" font-family:'monospace';">TaskHandler</span>. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Метод <span style=" font-family:'monospace';">handleTimeoutException()</span> вызывается при истечении таймаута задачи. Если окно, в котором выполняется задача, закрывается, то задача останавливается без оповещения. </li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="background_tasks_run"></a>Метод <span style=" font-family:'monospace';">run()</span> задачи должен поддерживать возможность прерывания извне. Для этого в долгих процессах желательно периодически проверять флаг <span style=" font-family:'monospace';">TaskLifeCycle.isInterrupted()</span>, и соответственно завершать выполнение. Кроме того, нельзя тихо проглатывать исключение <span style=" font-family:'monospace';">InterruptedException</span> (или вообще все исключения). Вместо этого нужно либо вообще не перехватывать его, либо выполнять корректный выход из метода. </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Метод <span style=" font-family:'monospace';">isCancelled()</span> возвращает <span style=" font-family:'monospace';">true</span>, если задача была прервана вызовом метода <span style=" font-family:'monospace';">cancel()</span>. </li></ul>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">public String run(TaskLifeCycle&lt;Integer&gt; taskLifeCycle) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    for (int i = 0; i &lt; 9_000_000; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        if (taskLifeCycle.isCancelled()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            log.info(&quot; &gt;&gt;&gt; Task was cancelled&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            break;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        } else {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            log.info(&quot; &gt;&gt;&gt; Task is working: iteration #&quot; + i);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    return &quot;Done&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">} </span></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Объекты <span style=" font-family:'monospace';">BackgroundTask</span> не имеют состояния. Если при реализации конкретного класса задачи не заводить полей для хранения промежуточных данных, то можно запускать несколько параллельно работающих процессов, используя единственный экземпляр задачи. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Объект <span style=" font-family:'monospace';">BackgroundHandler</span> можно запускать (т.е. вызывать его метод <span style=" font-family:'monospace';">execute()</span>) всего один раз. Если требуется частый перезапуск задачи, то используйте класс <span style=" font-family:'monospace';">BackgroundTaskWrapper</span>. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для показа пользователю модального окна с прогрессом и кнопкой <span style=" font-weight:600;">Отмена</span> используйте классы <span style=" font-family:'monospace';">BackgroundWorkWindow</span> или <span style=" font-family:'monospace';">BackgroundWorkProgressWindow</span> с набором статических методов.Для окна можно задать режим отображения прогресса и разрешить или запретить отмену фоновой задачи. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если внутри потока задачи необходимо использовать некоторые значения визуальных компонентов, то нужно реализовать их получение в методе <span style=" font-family:'monospace';">getParams()</span>, который выполняется в потоке UI один раз при запуске задачи. В методе run() эти параметры будут доступны через метод <span style=" font-family:'monospace';">getParams()</span> объекта <span style=" font-family:'monospace';">TaskLifeCycle</span>. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При возникновении исключительных ситуаций в потоке UI вызывается метод <span style=" font-family:'monospace';">BackgroundTask.handleException()</span>, в котором можно отобразить ошибку. </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На выполнение фоновых задач влияют свойства приложения <a href="https://doc.cuba-platform.com/manual-6.10-ru/manual.html#cuba.backgroundWorker.maxActiveTasksCount"><span style=" text-decoration: underline; color:#0000ff;">cuba.backgroundWorker.maxActiveTasksCount</span></a> и <a href="https://doc.cuba-platform.com/manual-6.10-ru/manual.html#cuba.backgroundWorker.timeoutCheckInterval"><span style=" text-decoration: underline; color:#0000ff;">cuba.backgroundWorker.timeoutCheckInterval</span></a>. </li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif'; font-size:9pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В блоке Web Client фоновые задачи используют технологию HTTP push, предоставляемую фреймворком Vaadin. См. </span><a href="https://vaadin.com/wiki/-/wiki/Main/Working+around+push+issues"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">https://vaadin.com/wiki/-/wiki/Main/Working+around+push+issues</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> для получения информации о настройке веб-серверов для использования данной технологии. </span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif'; font-size:9pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Если вы не используете фоновую задачу, но хотите изменять состояние UI-компонентов из не-UI потока, воспользуйтесь методами интерфейса </span><span style=" font-family:'monospace'; font-size:9pt;">UIAccessor</span><span style=" font-family:'Sans Serif'; font-size:9pt;">. Получите ссылку на интерфейс </span><span style=" font-family:'monospace'; font-size:9pt;">UIAccessor</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> методом </span><span style=" font-family:'monospace'; font-size:9pt;">BackgroundWorker.getUIAccessor()</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> в UI-потоке, и после этого вы сможете вызывать его методы </span><span style=" font-family:'monospace'; font-size:9pt;">access()</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> и </span><span style=" font-family:'monospace'; font-size:9pt;">accessSynchronously()</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> из фонового потока для безопасного чтения и изменения состояния UI-компонентов. </span></p></td></tr></table></body></html>